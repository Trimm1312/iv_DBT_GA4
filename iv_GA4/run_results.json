{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.4", "generated_at": "2024-01-16T15:45:03.420836Z", "invocation_id": "7efa5409-f3e8-4608-9b38-15425704876b", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:43:58.361237Z", "completed_at": "2024-01-16T15:43:58.361241Z"}, {"name": "execute", "started_at": "2024-01-16T15:43:58.362308Z", "completed_at": "2024-01-16T15:44:02.376949Z"}], "thread_id": "Thread-2", "execution_time": 4.022754430770874, "adapter_response": {"_message": "INSERT 819", "code": "INSERT", "rows_affected": 819}, "message": "INSERT 819", "failures": null, "unique_id": "seed.ga4.ga4_source_categories", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:43:58.355323Z", "completed_at": "2024-01-16T15:43:58.444201Z"}, {"name": "execute", "started_at": "2024-01-16T15:43:58.445357Z", "completed_at": "2024-01-16T15:44:12.305139Z"}], "thread_id": "Thread-1", "execution_time": 13.952127695083618, "adapter_response": {"_message": "MERGE (11.8m rows, 9.1 GiB processed)", "code": "MERGE", "rows_affected": 11781546, "bytes_processed": 9725978357, "bytes_billed": 9726590976, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "73a46b4a-5e4f-409d-b252-8bb4c32e4189", "slot_ms": 1356416}, "message": "MERGE (11.8m rows, 9.1 GiB processed)", "failures": null, "unique_id": "model.ga4.base_ga4__events", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\n\nwith source as (\n    select \n        \n    parse_date('%Y%m%d',event_date) as event_date_dt\n    , event_timestamp\n    , event_name\n    , event_params\n    , event_previous_timestamp\n    , event_value_in_usd\n    , event_bundle_sequence_id\n    , event_server_timestamp_offset\n    , user_id\n    , user_pseudo_id\n    , privacy_info\n    , user_properties\n    , user_first_touch_timestamp\n    , user_ltv\n    , device\n    , geo\n    , app_info\n    , traffic_source\n    , stream_id\n    , platform\n    , ecommerce.total_item_quantity\n    , ecommerce.purchase_revenue_in_usd\n    , ecommerce.purchase_revenue\n    , ecommerce.refund_value_in_usd\n    , ecommerce.refund_value\n    , ecommerce.shipping_value_in_usd\n    , ecommerce.shipping_value\n    , ecommerce.tax_value_in_usd\n    , ecommerce.tax_value\n    , ecommerce.unique_items\n    , ecommerce.transaction_id\n    , items\n\n        from `set-ga-reporting`.`analytics_270752382`.`events_*`\n        where cast( replace(_table_suffix, 'intraday_', '') as int64) >= 20231201\n    \n        and parse_date('%Y%m%d', left( replace(_table_suffix, 'intraday_', ''), 8)) in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n    \n),\nrenamed as (\n    select \n        \n    event_date_dt\n    , event_timestamp\n    , lower(replace(trim(event_name), \" \", \"_\")) as event_name -- Clean up all event names to be snake cased\n    , event_params\n    , event_previous_timestamp\n    , event_value_in_usd\n    , event_bundle_sequence_id\n    , event_server_timestamp_offset\n    , user_id\n    , user_pseudo_id\n    , privacy_info.analytics_storage as privacy_info_analytics_storage\n    , privacy_info.ads_storage as privacy_info_ads_storage\n    , privacy_info.uses_transient_token as privacy_info_uses_transient_token\n    , user_properties\n    , user_first_touch_timestamp\n    , user_ltv.revenue as user_ltv_revenue\n    , user_ltv.currency as user_ltv_currency\n    , device.category as device_category\n    , device.mobile_brand_name as device_mobile_brand_name\n    , device.mobile_model_name as device_mobile_model_name\n    , device.mobile_marketing_name as device_mobile_marketing_name\n    , device.mobile_os_hardware_model as device_mobile_os_hardware_model\n    , device.operating_system as device_operating_system\n    , device.operating_system_version as device_operating_system_version\n    , device.vendor_id as device_vendor_id\n    , device.advertising_id as device_advertising_id\n    , device.language as device_language\n    , device.is_limited_ad_tracking as device_is_limited_ad_tracking\n    , device.time_zone_offset_seconds as device_time_zone_offset_seconds\n    , device.browser as device_browser\n    , device.browser_version as device_browser_version\n    , device.web_info.browser as device_web_info_browser\n    , device.web_info.browser_version as device_web_info_browser_version\n    , device.web_info.hostname as device_web_info_hostname\n    , geo.continent as geo_continent\n    , geo.country as geo_country\n    , geo.region as geo_region\n    , geo.city as geo_city\n    , geo.sub_continent as geo_sub_continent\n    , geo.metro as geo_metro\n    , app_info.id as app_info_id\n    , app_info.version as app_info_version\n    , app_info.install_store as app_info_install_store\n    , app_info.firebase_app_id as app_info_firebase_app_id\n    , app_info.install_source as app_info_install_source\n    , traffic_source.name as user_campaign\n    , traffic_source.medium as user_medium\n    , traffic_source.source as user_source\n    , stream_id\n    , platform\n    , struct(\n        total_item_quantity\n        , purchase_revenue_in_usd\n        , purchase_revenue\n        , refund_value_in_usd\n        , refund_value\n        , shipping_value_in_usd\n        , shipping_value\n        , tax_value_in_usd\n        , tax_value\n        , unique_items\n        , transaction_id        \n    ) as ecommerce\n    , (select \n        array_agg(struct(\n            unnested_items.item_id\n            , unnested_items.item_name\n            , unnested_items.item_brand\n            , unnested_items.item_variant\n            , unnested_items.item_category\n            , unnested_items.item_category2\n            , unnested_items.item_category3\n            , unnested_items.item_category4\n            , unnested_items.item_category5\n            , unnested_items.price_in_usd\n            , unnested_items.price\n            , unnested_items.quantity\n            , unnested_items.item_revenue_in_usd\n            , unnested_items.item_revenue\n            , unnested_items.item_refund_in_usd\n            , unnested_items.item_refund\n            , unnested_items.coupon\n            , unnested_items.affiliation\n            , unnested_items.location_id\n            , unnested_items.item_list_id\n            , unnested_items.item_list_name\n            , unnested_items.item_list_index\n            , unnested_items.promotion_id\n            , unnested_items.promotion_name\n            , unnested_items.creative_name\n            , unnested_items.creative_slot\n            , unnested_items.item_params\n        )) from unnest(items) as unnested_items \n    ) items\n    , (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'ga_session_id') as \n    \n    session_id\n    \n    , (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'page_location') as \n    \n    page_location\n    \n    , (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'ga_session_number') as \n    \n    session_number\n    \n    , COALESCE(\n        (SELECT value.int_value FROM unnest(event_params) WHERE key = \"session_engaged\"),\n        (CASE WHEN (SELECT value.string_value FROM unnest(event_params) WHERE key = \"session_engaged\") = \"1\" THEN 1 END)\n    ) as session_engaged\n    , (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'engagement_time_msec') as \n    \n    engagement_time_msec\n    \n    , (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'page_title') as \n    \n    page_title\n    \n    , (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'page_referrer') as \n    \n    page_referrer\n    \n    , (select \n        \n            lower(value.string_value)   \n        \n    from unnest(event_params) where key = 'source') as \n    \n    event_source\n    \n    , (select \n        \n            lower(value.string_value)   \n        \n    from unnest(event_params) where key = 'medium') as \n    \n    event_medium\n    \n    , (select \n        \n            lower(value.string_value)   \n        \n    from unnest(event_params) where key = 'campaign') as \n    \n    event_campaign\n    \n    , (select \n        \n            lower(value.string_value)   \n        \n    from unnest(event_params) where key = 'content') as \n    \n    event_content\n    \n    , (select \n        \n            lower(value.string_value)   \n        \n    from unnest(event_params) where key = 'term') as \n    \n    event_term\n    \n    , CASE \n        WHEN event_name = 'page_view' THEN 1\n        ELSE 0\n    END AS is_page_view\n    , CASE \n        WHEN event_name = 'purchase' THEN 1\n        ELSE 0\n    END AS is_purchase\n\n    from source\n)\n\nselect * from renamed\nqualify row_number() over(partition by event_date_dt, stream_id,user_pseudo_id, session_id, event_name, event_timestamp, to_json_string(ARRAY(SELECT params FROM UNNEST(event_params) AS params ORDER BY key))) = 1", "relation_name": "`set-ga-reporting`.`iv_GA4`.`base_ga4__events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:12.310549Z", "completed_at": "2024-01-16T15:44:12.336003Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:12.337302Z", "completed_at": "2024-01-16T15:44:12.979528Z"}], "thread_id": "Thread-4", "execution_time": 0.6705613136291504, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "c59d7684-03c8-497f-81e9-331c32b22cac", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__events", "compiled": true, "compiled_code": "-- This staging model contains key creation and window functions. Keeping window functions outside of the base incremental model ensures that the incremental updates don't artificially limit the window partition sizes (ex: if a session spans 2 days, but only 1 day is in the incremental update)\nwith base_events as (\n    select * from `set-ga-reporting`.`iv_GA4`.`base_ga4__events`\n),\n-- Add key that captures a combination of stream_id and user_pseudo_id to uniquely identify a 'client' (aka. a device) within a single stream\ninclude_client_key as (\n    select *\n    , to_base64(md5(concat(user_pseudo_id, stream_id))) as client_key\n    from base_events\n),\n-- Add key for sessions. session_key will be null if client_key is null due to consent being denied. ga_session_id may be null during audience trigger events. \ninclude_session_key as (\n    select \n        *,\n        to_base64(md5(CONCAT(client_key, CAST(session_id as STRING)))) as session_key\n    from include_client_key\n),\n-- Add a key that combines session key and date. Useful when working with session table within date-partitioned tables\ninclude_session_partition_key as (\n    select \n        *,\n        CONCAT(session_key, CAST(event_date_dt as STRING)) as session_partition_key\n    from include_session_key\n),\n-- Add unique key for events\ninclude_event_key as (\n    select \n        *,\n        to_base64(md5(CONCAT(session_key, event_name, CAST(event_timestamp as STRING), to_json_string(event_params)))) as event_key -- Surrogate key for unique events.  \n    from include_session_partition_key\n),\ndetect_gclid as (\n    select\n        * except (event_source, event_medium, event_campaign),\n        case\n            when (page_location like '%gclid%' and event_source is null) then \"google\"\n            else event_source\n        end as event_source,\n        case\n            when (page_location like '%gclid%' and event_medium is null) then \"cpc\"\n            else event_medium\n        end as event_medium,\n        case\n            when (page_location like '%gclid%' and event_campaign is null) then \"(cpc)\"\n            else event_campaign\n        end as event_campaign\n    from include_event_key\n),\n\nremove_query_params as (\n    select \n        * EXCEPT (page_location, page_referrer),\n        page_location as original_page_location,\n        page_referrer as original_page_referrer,\n        \n   REGEXP_EXTRACT(page_location, '(?:\\\\w+:)?\\\\/\\\\/[^\\\\/]+([^?#]+)')\n as page_path,\n        -- If there are query parameters to exclude, exclude them using regex\n        \n        \nREGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(page_location, '(\\\\?|&)(gclid|fbclid|_ga)=[^&]*', '\\\\1'), '\\\\?&+', '?'), '&+', '&'), '\\\\?$|&$', '')\n as page_location,\n        \nREGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(page_referrer, '(\\\\?|&)(gclid|fbclid|_ga)=[^&]*', '\\\\1'), '\\\\?&+', '?'), '&+', '&'), '\\\\?$|&$', '')\n as page_referrer\n        \n\n        \n        from detect_gclid\n        \n),\nenrich_params as (\n    select \n        *,\n        \n    REGEXP_EXTRACT(page_location, '(?:http[s]?://)?(?:www\\\\.)?(.*?)(?:(?:/|:)(?:.)*|$)')\n as page_hostname,\n        \n    REGEXP_EXTRACT(page_location, '\\\\?(.+)')\n as page_query_string,\n    from remove_query_params\n),\npage_key as (\n    select\n        *,\n        (concat( cast(event_date_dt as string), page_location )) as page_key,\n        case\n            when event_name = 'page_view' then to_base64(md5(concat(session_key, page_referrer)))\n            else to_base64(md5(concat(session_key, page_location)))\n        end as page_engagement_key\n    from enrich_params\n)\nselect * from page_key", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__events`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:12.984498Z", "completed_at": "2024-01-16T15:44:13.137912Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:13.139168Z", "completed_at": "2024-01-16T15:44:17.172516Z"}], "thread_id": "Thread-2", "execution_time": 4.1896257400512695, "adapter_response": {"_message": "SELECT (1.0 rows, 23.9 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 25617274825, "bytes_billed": 25617760256, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "769410e5-4af4-445b-86d6-d331fd02ed22", "slot_ms": 1140740}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__events_event_key.985cc306e5", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select event_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n  where event_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:17.196428Z", "completed_at": "2024-01-16T15:44:17.234272Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:17.250603Z", "completed_at": "2024-01-16T15:44:18.106801Z"}], "thread_id": "Thread-1", "execution_time": 0.9253063201904297, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "0d6eac93-a9d5-4d44-a7e6-f4bcc356c099", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_click", "compiled": true, "compiled_code": "-- reference here: https://support.google.com/analytics/answer/9216061?hl=en \n \n with click_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'entrances') as \n    \n    entrances\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'outbound') as \n    \n    outbound\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_classes') as \n    \n    link_classes\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_domain') as \n    \n    link_domain\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_url') as \n    \n    link_url\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'click_element') as \n    \n    click_element\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_id') as \n    \n    link_id\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'click_region') as \n    \n    click_region\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'click_tag_name') as \n    \n    click_tag_name\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'click_url') as \n    \n    click_url\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'file_name') as \n    \n    file_name\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n where event_name = 'click'\n)\n\nselect * from click_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_click`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:17.199724Z", "completed_at": "2024-01-16T15:44:17.233536Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:17.247033Z", "completed_at": "2024-01-16T15:44:18.142533Z"}], "thread_id": "Thread-2", "execution_time": 0.960299015045166, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "1529ca25-bf77-49a6-b0d8-9c72782ea862", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_file_download", "compiled": true, "compiled_code": "-- reference here: https://support.google.com/analytics/answer/9216061?hl=en&ref_topic=9756175\n \n with event_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'entrances') as \n    \n    entrances\n    ,\n      (select \n        \n            value.float_value    \n        \n    from unnest(event_params) where key = 'value') as \n    \n    value\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'file_extension') as \n    \n    file_extension\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'file_name') as \n    \n    file_name\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_classes') as \n    \n    link_classes\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_domain') as \n    \n    link_domain\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_id') as \n    \n    link_id\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_text') as \n    \n    link_text\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'link_url') as \n    \n    link_url\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'file_download'\n)\n\nselect * from event_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_file_download`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:18.111360Z", "completed_at": "2024-01-16T15:44:18.129047Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:18.130153Z", "completed_at": "2024-01-16T15:44:18.777451Z"}], "thread_id": "Thread-1", "execution_time": 0.6675589084625244, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "bf0095f4-7393-41cf-bcb3-bb01d839e49f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_first_visit", "compiled": true, "compiled_code": "-- TODO: Unclear why there are first_visit events firing when the ga_session_number is >1. This might cause confusion.\n\nwith first_visit_with_params as (\n select \n    *,\n    (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'page_location') as \n    \n    landing_page\n     \n    \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'first_visit'\n)\n\nselect * from first_visit_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_first_visit`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:18.147464Z", "completed_at": "2024-01-16T15:44:18.165078Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:18.166765Z", "completed_at": "2024-01-16T15:44:18.790494Z"}], "thread_id": "Thread-2", "execution_time": 0.6444869041442871, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "53dac5f5-d60e-46b1-8740-da90d11357c7", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_items", "compiled": true, "compiled_code": "with items_with_params as (\n    select\n        event_key,\n        event_name,\n        event_date_dt,\n        stream_id,\n        i.item_id,\n        i.item_name,\n        i.item_brand,\n        i.item_variant,\n        i.item_category,\n        i.item_category2,\n        i.item_category3,\n        i.item_category4,\n        i.item_category5,\n        i.price_in_usd,\n        i.price,\n        i.quantity,\n        i.item_revenue_in_usd,\n        i.item_revenue,\n        i.item_refund_in_usd,\n        i.item_refund,\n        i.coupon,\n        i.affiliation,\n        i.location_id,\n        i.item_list_id,\n        i.item_list_name,\n        i.item_list_index,\n        i.promotion_id,\n        i.promotion_name,\n        i.creative_name,\n        i.creative_slot\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`,\n        unnest(items) as i\n    where event_name in ('add_payment_info', 'add_shipping_info', 'add_to_cart','add_to_wishlist','begin_checkout' ,'purchase','refund', 'remove_from_cart','select_item', 'select_promotion','view_item_list','view_promotion', 'view_item')\n)\n\nselect * from items_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_items`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:18.794696Z", "completed_at": "2024-01-16T15:44:18.814094Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:18.815169Z", "completed_at": "2024-01-16T15:44:19.428839Z"}], "thread_id": "Thread-2", "execution_time": 0.6356251239776611, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "4ec17d64-1f88-480c-a653-c195ad12a726", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_scroll", "compiled": true, "compiled_code": "with scroll_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'percent_scrolled') as \n    \n    percent_scrolled\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'scroll'\n)\n\nselect * from scroll_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_scroll`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:18.782123Z", "completed_at": "2024-01-16T15:44:18.804956Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:18.805959Z", "completed_at": "2024-01-16T15:44:19.466691Z"}], "thread_id": "Thread-1", "execution_time": 0.6859602928161621, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "28a16736-c4ca-444f-868d-a62f0e02469a", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_page_view", "compiled": true, "compiled_code": "with page_view_with_params as (\n   select * except(page_engagement_key),\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'entrances') as \n    \n    entrances\n    ,\n      (select \n        \n            value.float_value    \n        \n    from unnest(event_params) where key = 'value') as \n    \n    value\n    ,\n      case when split(split(page_location,'/')[safe_ordinal(4)],'?')[safe_ordinal(1)] = '' then null else concat('/',split(split(page_location,'/')[safe_ordinal(4)],'?')[safe_ordinal(1)]) end as pagepath_level_1,\n      case when split(split(page_location,'/')[safe_ordinal(5)],'?')[safe_ordinal(1)] = '' then null else concat('/',split(split(page_location,'/')[safe_ordinal(5)],'?')[safe_ordinal(1)]) end as pagepath_level_2,\n      case when split(split(page_location,'/')[safe_ordinal(6)],'?')[safe_ordinal(1)] = '' then null else concat('/',split(split(page_location,'/')[safe_ordinal(6)],'?')[safe_ordinal(1)]) end as pagepath_level_3,\n      case when split(split(page_location,'/')[safe_ordinal(7)],'?')[safe_ordinal(1)] = '' then null else concat('/',split(split(page_location,'/')[safe_ordinal(7)],'?')[safe_ordinal(1)]) end as pagepath_level_4,\n      to_base64(md5(concat(session_key, page_location))) as page_engagement_key\n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'page_view'\n)\nselect *\nfrom page_view_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:19.433406Z", "completed_at": "2024-01-16T15:44:19.454334Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:19.455407Z", "completed_at": "2024-01-16T15:44:20.071389Z"}], "thread_id": "Thread-2", "execution_time": 0.6394224166870117, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "5175d90f-b4bf-4218-ab4c-749f58d43f06", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_session_start", "compiled": true, "compiled_code": "with session_start_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'entrances') as \n    \n    entrances\n    ,\n      (select \n        \n            value.float_value    \n        \n    from unnest(event_params) where key = 'value') as \n    \n    value\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'session_start'\n)\n\nselect * from session_start_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_session_start`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:19.471137Z", "completed_at": "2024-01-16T15:44:19.487243Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:19.488284Z", "completed_at": "2024-01-16T15:44:20.124322Z"}], "thread_id": "Thread-1", "execution_time": 0.6546270847320557, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "784b2108-dd9e-416d-8d82-d18331a1e7b0", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_to_query_string_params", "compiled": true, "compiled_code": "with event_and_query_string as \n(\n    select \n        event_key,\n        split(page_query_string, '&') as qs_split\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n),\nflattened_qs as\n(\n    select \n        event_key, \n        params \n    from event_and_query_string, unnest(qs_split) as params\n),\nsplit_param_value as \n(\n    select \n        event_key, \n        split(params,'=')[SAFE_OFFSET(0)] as param, \n        NULLIF(split(params,'=')[SAFE_OFFSET(1)], '') as value \n    from flattened_qs\n)\n\nselect * from split_param_value", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_to_query_string_params`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:20.075969Z", "completed_at": "2024-01-16T15:44:20.093740Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:20.094870Z", "completed_at": "2024-01-16T15:44:20.705721Z"}], "thread_id": "Thread-2", "execution_time": 0.6312205791473389, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "c2853ab8-df71-4728-b326-589c5d4d7e2a", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_user_engagement", "compiled": true, "compiled_code": "-- Event defined as \"when the app is in the foreground or webpage is in focus for at least one second.\"\n \n with user_engagement_with_params as (\n   select *\n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'user_engagement'\n)\n\nselect * from user_engagement_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_user_engagement`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:20.128583Z", "completed_at": "2024-01-16T15:44:20.148047Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:20.149120Z", "completed_at": "2024-01-16T15:44:20.801335Z"}], "thread_id": "Thread-1", "execution_time": 0.674227237701416, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "d9969c5d-7309-4649-b41c-1326e8d28cc3", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_video_complete", "compiled": true, "compiled_code": "-- Defined as when the video ends. For embedded YouTube videos that have JS API support enabled. Collected by default via enhanced measurement.\n-- More info: https://support.google.com/firebase/answer/9234069?hl=en\n \n with video_complete_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_current_time') as \n    \n    video_current_time\n    ,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_duration') as \n    \n    video_duration\n    ,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_percent') as \n    \n    video_percent\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'video_url') as \n    \n    video_url\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'video_provider') as \n    \n    video_provider\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'vide_title') as \n    \n    vide_title\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'visible') as \n    \n    visible\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'video_complete'\n)\n\nselect * from video_complete_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_video_complete`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:20.805926Z", "completed_at": "2024-01-16T15:44:20.832438Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:20.833922Z", "completed_at": "2024-01-16T15:44:21.441272Z"}], "thread_id": "Thread-1", "execution_time": 0.636742353439331, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "eaf719eb-2af0-4968-b1ca-ffdf2ddd976b", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_view_search_results", "compiled": true, "compiled_code": "-- reference here: https://support.google.com/analytics/answer/9216061?hl=en \n \n with event_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'entrances') as \n    \n    entrances\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'search_term') as \n    \n    search_term\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'unique_search_term') as \n    \n    unique_search_term\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n where event_name = 'view_search_results'\n)\n\nselect * from event_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_view_search_results`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:20.710305Z", "completed_at": "2024-01-16T15:44:20.729932Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:20.730953Z", "completed_at": "2024-01-16T15:44:21.452719Z"}], "thread_id": "Thread-2", "execution_time": 0.7438054084777832, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "b6671f79-633a-4a1e-80c0-cae7d3afc49f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__event_video_start", "compiled": true, "compiled_code": "-- Defined as when the video starts playing. For embedded YouTube videos that have JS API support enabled. Collected by default via enhanced measurement.\n-- More info: https://support.google.com/firebase/answer/9234069?hl=en\n \n with video_start_with_params as (\n   select *,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_current_time') as \n    \n    video_current_time\n    ,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_duration') as \n    \n    video_duration\n    ,\n      (select \n        \n            value.int_value    \n        \n    from unnest(event_params) where key = 'video_percent') as \n    \n    video_percent\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'video_url') as \n    \n    video_url\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'video_provider') as \n    \n    video_provider\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'vide_title') as \n    \n    vide_title\n    ,\n      (select \n        \n            value.string_value    \n        \n    from unnest(event_params) where key = 'visible') as \n    \n    visible\n    \n      \n      \n from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`    \n where event_name = 'video_start'\n)\n\nselect * from video_start_with_params", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__event_video_start`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:21.446239Z", "completed_at": "2024-01-16T15:44:21.466809Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:21.467863Z", "completed_at": "2024-01-16T15:44:22.088434Z"}], "thread_id": "Thread-1", "execution_time": 0.6440215110778809, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "a74a3a88-4d38-4781-8f4b-b6c157b4ae3c", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__page_engaged_time", "compiled": true, "compiled_code": "with pek_time as (\nselect\n    page_engagement_key,\n    sum(engagement_time_msec) as page_engagement_time,\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\ngroup by 1\n),\nmatched_pv as ( -- need to replace the pek with one that uses page_location to match back to correct page_view\n    select\n        to_base64(md5(concat(session_key, page_location))) as page_engagement_key, \n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where event_name = 'page_view'\n),\ndenominator as ( \n    select\n        page_engagement_key,\n        count(page_engagement_key) as page_engagement_denominator, --for sessions with multiple hits to the same page\n    from matched_pv\n    group by 1\n)\nselect\n    denominator.page_engagement_key,\n    case\n        when pek_time.page_engagement_time is null then null -- safe_divide in the numerator would return 0; we need null to prevent page views with no recorded engagement time from factoring in to later calculations\n        else safe_divide(pek_time.page_engagement_time , denominator.page_engagement_denominator) \n    end as page_engagement_time_msec, --technically the average engagement time for that page in that session\n    case \n        when pek_time.page_engagement_time is null then null -- remove page_views with no engagement time from the denominator\n        else denominator.page_engagement_denominator \n    end as page_engagement_denominator\nfrom denominator \nleft join pek_time using(page_engagement_key)", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__page_engaged_time`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:21.457144Z", "completed_at": "2024-01-16T15:44:21.477073Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:21.478170Z", "completed_at": "2024-01-16T15:44:22.123349Z"}], "thread_id": "Thread-2", "execution_time": 0.6676352024078369, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "da06a962-cb3f-413f-94ec-e5680a062a7f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__sessions_first_last_pageviews", "compiled": true, "compiled_code": "with page_views_first_last as (\n    select\n        session_key,\n        FIRST_VALUE(event_key) OVER (PARTITION BY session_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_page_view_event_key,\n        LAST_VALUE(event_key) OVER (PARTITION BY session_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_page_view_event_key\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where event_name = 'page_view'\n),\npage_views_by_session_key as (\n    select distinct\n        session_key,\n        first_page_view_event_key,\n        last_page_view_event_key\n    from page_views_first_last\n)\n\nselect * from page_views_by_session_key", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_first_last_pageviews`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:17.183373Z", "completed_at": "2024-01-16T15:44:17.220942Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:17.222777Z", "completed_at": "2024-01-16T15:44:22.315887Z"}], "thread_id": "Thread-3", "execution_time": 5.136834621429443, "adapter_response": {"_message": "MERGE (516.4k rows, 584.7 MiB processed)", "code": "MERGE", "rows_affected": 516433, "bytes_processed": 613056968, "bytes_billed": 613416960, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "503be2da-d7be-470d-851d-2b8d080f4367", "slot_ms": 37188}, "message": "MERGE (516.4k rows, 584.7 MiB processed)", "failures": null, "unique_id": "model.ga4.fct_ga4__sessions_daily", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\n\nwith session_metrics as (\n    select \n        session_key,\n        session_partition_key,\n        client_key,\n        stream_id,\n        max(user_id) as user_id, -- user_id can be null at the start and end of a session and still be set in the middle\n        min(event_date_dt) as session_partition_date, -- Date of the session partition, does not represent the true session start date which, in GA4, can span multiple days\n        min(event_timestamp) as session_partition_min_timestamp,\n        countif(event_name = 'page_view') as session_partition_count_page_views,\n        sum(event_value_in_usd) as session_partition_sum_event_value_in_usd,\n        ifnull(max(session_engaged), 0) as session_partition_max_session_engaged,\n        sum(engagement_time_msec) as session_partition_sum_engagement_time_msec,\n        min(session_number) as session_number\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where session_key is not null\n    \n            and event_date_dt in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n    \n    group by 1,2,3,4\n)\n\n    select * from session_metrics\n", "relation_name": "`set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions_daily`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:22.092935Z", "completed_at": "2024-01-16T15:44:22.133654Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:22.136670Z", "completed_at": "2024-01-16T15:44:22.842081Z"}], "thread_id": "Thread-1", "execution_time": 0.7508246898651123, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "3d3c89f2-32bc-49a4-a209-d0c1c61d3f7f", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__sessions_traffic_sources", "compiled": true, "compiled_code": "with session_events as (\n    select\n        session_key\n        ,event_timestamp\n        ,events.event_source\n        ,event_medium\n        ,event_campaign\n        ,event_content\n        ,event_term\n        ,source_category\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events` events\n    left join `set-ga-reporting`.`iv_GA4`.`ga4_source_categories` source_categories on events.event_source = source_categories.source\n    where session_key is not null\n    and event_name != 'session_start'\n    and event_name != 'first_visit'\n   ),\nset_default_channel_grouping as (\n    select\n        *\n        ,\ncase\n  -- Direct: Source exactly matches \"(direct)\" AND Medium is one of (\"(not set)\", \"(none)\")\n  when (\n      event_source is null\n        and event_medium is null\n    )\n    or (\n      event_source = '(direct)'\n      and (event_medium = '(none)' or event_medium = '(not set)')\n    )\n    then 'Direct'\n\n  -- Cross-network: Campaign Name contains \"cross-network\"\n  when REGEXP_CONTAINS(event_campaign, r\"cross-network\")\n    then 'Cross-network'\n\n  -- Paid Shopping:\n  --   (Source matches a list of shopping sites\n  --   OR\n  --   Campaign Name matches regex ^(.*(([^a-df-z]|^)shop|shopping).*)$)\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when (\n      source_category = 'SOURCE_CATEGORY_SHOPPING'\n      or REGEXP_CONTAINS(event_campaign, r\"^(.*(([^a-df-z]|^)shop|shopping).*)$\")\n    )\n    and REGEXP_CONTAINS(event_medium,r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Shopping'\n\n  -- Paid Search:\n  --   Source matches a list of search sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_SEARCH'\n    and REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Search'\n\n  -- Paid Social:\n  --   Source matches a regex list of social sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_SOCIAL'\n    and REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Social'\n\n  -- Paid Video:\n  --   Source matches a list of video sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_VIDEO'\n    and REGEXP_CONTAINS(event_medium,r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Video'\n\n  -- Display:\n  --   Medium is one of (\"display\", \"banner\", \"expandable\", \"interstitial\", \"cpm\")\n  when event_medium in ('display', 'banner', 'expandable', 'interstitial', 'cpm')\n    then 'Display'\n\n  -- Paid Other:\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Other'\n\n  -- Organic Shopping:\n  --   Source matches a list of shopping sites\n  --   OR\n  --   Campaign name matches regex ^(.*(([^a-df-z]|^)shop|shopping).*)$\n  when source_category = 'SOURCE_CATEGORY_SHOPPING'\n    or REGEXP_CONTAINS(event_campaign, r\"^(.*(([^a-df-z]|^)shop|shopping).*)$\")\n    then 'Organic Shopping'\n\n  -- Organic Social:\n  --   Source matches a regex list of social sites\n  --   OR\n  --   Medium is one of (\"social\", \"social-network\", \"social-media\", \"sm\", \"social network\", \"social media\")\n  when source_category = 'SOURCE_CATEGORY_SOCIAL'\n    or event_medium in (\"social\",\"social-network\",\"social-media\",\"sm\",\"social network\",\"social media\")\n    then 'Organic Social'\n\n  -- Organic Video:\n  --   Source matches a list of video sites\n  --   OR\n  --   Medium matches regex ^(.*video.*)$\n  when source_category = 'SOURCE_CATEGORY_VIDEO'\n    or REGEXP_CONTAINS(event_medium, r\"^(.*video.*)$\")\n    then 'Organic Video'\n\n  -- Organic Search:\n  --   Source matches a list of search sites\n  --   OR\n  --   Medium exactly matches organic\n  when source_category = 'SOURCE_CATEGORY_SEARCH' or event_medium = 'organic'\n    then 'Organic Search'\n\n  -- Referral:\n  --   Medium is one of (\"referral\", \"app\", or \"link\")\n  when event_medium in (\"referral\", \"app\", \"link\")\n    then 'Referral'\n\n  -- Email:\n  --   Source = email|e-mail|e_mail|e mail\n  --   OR\n  --   Medium = email|e-mail|e_mail|e mail\n  when REGEXP_CONTAINS(event_source, r\"email|e-mail|e_mail|e mail\")\n    or REGEXP_CONTAINS(event_medium, r\"email|e-mail|e_mail|e mail\")\n    then 'Email'\n\n  -- Affiliates:\n  --   Medium = affiliate\n  when event_medium = 'affiliate'\n    then 'Affiliates'\n\n  -- Audio:\n  --   Medium exactly matches audio\n  when event_medium = 'audio'\n    then 'Audio'\n\n  -- SMS:\n  --   Source exactly matches sms\n  --   OR\n  --   Medium exactly matches sms\n  when event_source = 'sms'\n    or event_medium = 'sms'\n    then 'SMS'\n\n  -- Mobile Push Notifications:\n  --   Medium ends with \"push\"\n  --   OR\n  --   Medium contains \"mobile\" or \"notification\"\n  --   OR\n  --   Source exactly matches \"firebase\"\n  when REGEXP_CONTAINS(event_medium, r\"push$\")\n    or REGEXP_CONTAINS(event_medium, r\"mobile|notification\")\n    or event_source = 'firebase'\n    then 'Mobile Push Notifications'\n\n  -- Unassigned is the value Analytics uses when there are no other channel rules that match the event data.\n  else 'Unassigned'\nend\n\n as default_channel_grouping\n    from session_events\n),\nsession_source as (\n    select\n        session_key\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN event_source END) IGNORE NULLS) OVER (session_window), '(direct)') AS session_source\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_medium, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_medium\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(source_category, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_source_category\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_campaign, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_campaign\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_content, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_content\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_term, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_term\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(default_channel_grouping, 'Direct') END) IGNORE NULLS) OVER (session_window), 'Direct') AS session_default_channel_grouping\n    from set_default_channel_grouping\n    WINDOW session_window AS (PARTITION BY session_key ORDER BY event_timestamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)\n)\nselect distinct * from session_source", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:22.320966Z", "completed_at": "2024-01-16T15:44:22.343629Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:22.345494Z", "completed_at": "2024-01-16T15:44:22.956406Z"}], "thread_id": "Thread-3", "execution_time": 0.6370315551757812, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "7aa2e640-7da3-4b3c-821c-137ea905ef10", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__user_id_mapping", "compiled": true, "compiled_code": "with events_with_user_id as (\n    select \n        user_id,\n        client_key,\n        event_timestamp \n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where user_id is not null\n        and client_key is not null\n),\ninclude_last_seen_timestamp as (\n    select \n        user_id,\n        client_key,\n        max(event_timestamp) as last_seen_user_id_timestamp\n    from events_with_user_id\n    group by 1,2\n),\npick_latest_timestamp as (\n    select\n        user_id as last_seen_user_id,\n        client_key,\n        last_seen_user_id_timestamp\n    from include_last_seen_timestamp\n    -- Find the latest mapping between client_key and user_id\n    qualify row_number() over(partition by client_key order by last_seen_user_id_timestamp desc) = 1\n\n)\n\nselect * from pick_latest_timestamp", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__user_id_mapping`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:22.961904Z", "completed_at": "2024-01-16T15:44:22.979814Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:22.981118Z", "completed_at": "2024-01-16T15:44:24.701950Z"}], "thread_id": "Thread-3", "execution_time": 1.7417004108428955, "adapter_response": {"_message": "SELECT (1.0 rows, 106.8 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 112028760, "bytes_billed": 112197632, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "e2ee4fea-a3bb-44b5-b26f-17eb7fba3d1f", "slot_ms": 8116}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_fct_ga4__sessions_daily_session_partition_key.c7a2a3ef6c", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_partition_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions_daily`\n  where session_partition_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:22.848918Z", "completed_at": "2024-01-16T15:44:22.870524Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:22.871880Z", "completed_at": "2024-01-16T15:44:24.836400Z"}], "thread_id": "Thread-1", "execution_time": 1.9892046451568604, "adapter_response": {"_message": "SELECT (1.0 rows, 2.0 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 2117560190, "bytes_billed": 2118123520, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "2992690c-7e0d-4c26-8138-51e6d228fa20", "slot_ms": 34565}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__event_page_view_page_location.8b37318084", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect page_location\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view`\nwhere page_location is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:22.127829Z", "completed_at": "2024-01-16T15:44:22.166154Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:22.167517Z", "completed_at": "2024-01-16T15:44:26.870642Z"}], "thread_id": "Thread-2", "execution_time": 4.744227409362793, "adapter_response": {"_message": "MERGE (515.9k rows, 621.7 MiB processed)", "code": "MERGE", "rows_affected": 515868, "bytes_processed": 651859996, "bytes_billed": 652214272, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "60a1e93e-9adb-4235-835f-64753f788ebd", "slot_ms": 50902}, "message": "MERGE (515.9k rows, 621.7 MiB processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__sessions_traffic_sources_daily", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\n\nwith session_events as (\n    select\n        client_key\n        ,session_partition_key\n        ,event_date_dt as session_partition_date\n        ,event_timestamp\n        ,events.event_source\n        ,event_medium\n        ,event_campaign\n        ,event_content\n        ,event_term\n        ,source_category\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events` events\n    left join `set-ga-reporting`.`iv_GA4`.`ga4_source_categories` source_categories on events.event_source = source_categories.source\n    where session_partition_key is not null\n    and event_name != 'session_start'\n    and event_name != 'first_visit'\n    \n            and event_date_dt in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n    \n\n   ),\nset_default_channel_grouping as (\n    select\n        *\n        ,\ncase\n  -- Direct: Source exactly matches \"(direct)\" AND Medium is one of (\"(not set)\", \"(none)\")\n  when (\n      event_source is null\n        and event_medium is null\n    )\n    or (\n      event_source = '(direct)'\n      and (event_medium = '(none)' or event_medium = '(not set)')\n    )\n    then 'Direct'\n\n  -- Cross-network: Campaign Name contains \"cross-network\"\n  when REGEXP_CONTAINS(event_campaign, r\"cross-network\")\n    then 'Cross-network'\n\n  -- Paid Shopping:\n  --   (Source matches a list of shopping sites\n  --   OR\n  --   Campaign Name matches regex ^(.*(([^a-df-z]|^)shop|shopping).*)$)\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when (\n      source_category = 'SOURCE_CATEGORY_SHOPPING'\n      or REGEXP_CONTAINS(event_campaign, r\"^(.*(([^a-df-z]|^)shop|shopping).*)$\")\n    )\n    and REGEXP_CONTAINS(event_medium,r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Shopping'\n\n  -- Paid Search:\n  --   Source matches a list of search sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_SEARCH'\n    and REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Search'\n\n  -- Paid Social:\n  --   Source matches a regex list of social sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_SOCIAL'\n    and REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Social'\n\n  -- Paid Video:\n  --   Source matches a list of video sites\n  --   AND\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when source_category = 'SOURCE_CATEGORY_VIDEO'\n    and REGEXP_CONTAINS(event_medium,r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Video'\n\n  -- Display:\n  --   Medium is one of (\"display\", \"banner\", \"expandable\", \"interstitial\", \"cpm\")\n  when event_medium in ('display', 'banner', 'expandable', 'interstitial', 'cpm')\n    then 'Display'\n\n  -- Paid Other:\n  --   Medium matches regex ^(.*cp.*|ppc|retargeting|paid.*)$\n  when REGEXP_CONTAINS(event_medium, r\"^(.*cp.*|ppc|retargeting|paid.*)$\")\n    then 'Paid Other'\n\n  -- Organic Shopping:\n  --   Source matches a list of shopping sites\n  --   OR\n  --   Campaign name matches regex ^(.*(([^a-df-z]|^)shop|shopping).*)$\n  when source_category = 'SOURCE_CATEGORY_SHOPPING'\n    or REGEXP_CONTAINS(event_campaign, r\"^(.*(([^a-df-z]|^)shop|shopping).*)$\")\n    then 'Organic Shopping'\n\n  -- Organic Social:\n  --   Source matches a regex list of social sites\n  --   OR\n  --   Medium is one of (\"social\", \"social-network\", \"social-media\", \"sm\", \"social network\", \"social media\")\n  when source_category = 'SOURCE_CATEGORY_SOCIAL'\n    or event_medium in (\"social\",\"social-network\",\"social-media\",\"sm\",\"social network\",\"social media\")\n    then 'Organic Social'\n\n  -- Organic Video:\n  --   Source matches a list of video sites\n  --   OR\n  --   Medium matches regex ^(.*video.*)$\n  when source_category = 'SOURCE_CATEGORY_VIDEO'\n    or REGEXP_CONTAINS(event_medium, r\"^(.*video.*)$\")\n    then 'Organic Video'\n\n  -- Organic Search:\n  --   Source matches a list of search sites\n  --   OR\n  --   Medium exactly matches organic\n  when source_category = 'SOURCE_CATEGORY_SEARCH' or event_medium = 'organic'\n    then 'Organic Search'\n\n  -- Referral:\n  --   Medium is one of (\"referral\", \"app\", or \"link\")\n  when event_medium in (\"referral\", \"app\", \"link\")\n    then 'Referral'\n\n  -- Email:\n  --   Source = email|e-mail|e_mail|e mail\n  --   OR\n  --   Medium = email|e-mail|e_mail|e mail\n  when REGEXP_CONTAINS(event_source, r\"email|e-mail|e_mail|e mail\")\n    or REGEXP_CONTAINS(event_medium, r\"email|e-mail|e_mail|e mail\")\n    then 'Email'\n\n  -- Affiliates:\n  --   Medium = affiliate\n  when event_medium = 'affiliate'\n    then 'Affiliates'\n\n  -- Audio:\n  --   Medium exactly matches audio\n  when event_medium = 'audio'\n    then 'Audio'\n\n  -- SMS:\n  --   Source exactly matches sms\n  --   OR\n  --   Medium exactly matches sms\n  when event_source = 'sms'\n    or event_medium = 'sms'\n    then 'SMS'\n\n  -- Mobile Push Notifications:\n  --   Medium ends with \"push\"\n  --   OR\n  --   Medium contains \"mobile\" or \"notification\"\n  --   OR\n  --   Source exactly matches \"firebase\"\n  when REGEXP_CONTAINS(event_medium, r\"push$\")\n    or REGEXP_CONTAINS(event_medium, r\"mobile|notification\")\n    or event_source = 'firebase'\n    then 'Mobile Push Notifications'\n\n  -- Unassigned is the value Analytics uses when there are no other channel rules that match the event data.\n  else 'Unassigned'\nend\n\n as default_channel_grouping\n    from session_events\n),\nfirst_session_source as (\n    select\n        client_key\n        ,session_partition_key\n        ,session_partition_date\n        ,event_timestamp\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN event_source END) IGNORE NULLS) OVER (session_window), '(direct)') AS session_source\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_medium, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_medium\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(source_category, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_source_category\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_campaign, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_campaign\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_content, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_content\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(event_term, '(none)') END) IGNORE NULLS) OVER (session_window), '(none)') AS session_term\n        ,COALESCE(FIRST_VALUE((CASE WHEN event_source <> '(direct)' THEN COALESCE(default_channel_grouping, 'Direct') END) IGNORE NULLS) OVER (session_window), 'Direct') AS session_default_channel_grouping\n    from set_default_channel_grouping\n    WINDOW session_window AS (PARTITION BY session_partition_key ORDER BY event_timestamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)\n),\nfind_non_direct_session_partition_key as (\n\n    select\n        *\n        ,if(session_source <> '(direct)', session_partition_key, null) as non_direct_session_partition_key --provide the session_partition_key only if source is not direct. Useful for last non-direct attribution modeling\n    from first_session_source\n)\n\nselect\n        client_key\n        ,session_partition_key\n        ,session_partition_date\n        ,session_source\n        ,session_medium\n        ,session_source_category\n        ,session_campaign\n        ,session_content\n        ,session_term\n        ,session_default_channel_grouping\n        ,non_direct_session_partition_key\n        ,min(event_timestamp) as session_partition_timestamp\nfrom find_non_direct_session_partition_key\ngroup by 1,2,3,4,5,6,7,8,9,10,11", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_daily`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:24.706382Z", "completed_at": "2024-01-16T15:44:24.723620Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:24.724817Z", "completed_at": "2024-01-16T15:44:27.974070Z"}], "thread_id": "Thread-3", "execution_time": 3.2694013118743896, "adapter_response": {"_message": "SELECT (1.0 rows, 6.5 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 6961999223, "bytes_billed": 6962544640, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "39abe2de-cbf5-4766-966f-c07ab66b1c0b", "slot_ms": 392865}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__sessions_traffic_sources_session_source.49313fe211", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect session_source\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources`\nwhere session_source is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:26.875648Z", "completed_at": "2024-01-16T15:44:26.896119Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:26.897747Z", "completed_at": "2024-01-16T15:44:28.547689Z"}], "thread_id": "Thread-2", "execution_time": 1.6737329959869385, "adapter_response": {"_message": "SELECT (1.0 rows, 3.6 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 3884581578, "bytes_billed": 3884974080, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "73b48247-eb58-4e26-9376-9105d04ce89b", "slot_ms": 71271}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__user_id_mapping_client_key.7c63d41e4c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect client_key\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__user_id_mapping`\nwhere client_key is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:27.978196Z", "completed_at": "2024-01-16T15:44:27.995985Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:27.997116Z", "completed_at": "2024-01-16T15:44:29.945405Z"}], "thread_id": "Thread-3", "execution_time": 1.9688506126403809, "adapter_response": {"_message": "SELECT (1.0 rows, 3.6 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 3884581578, "bytes_billed": 3884974080, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "fb18cf18-d6b4-47ba-82cc-6f0b1acdd8a3", "slot_ms": 106066}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__user_id_mapping_client_key.cae6196948", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select client_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__user_id_mapping`\n  where client_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:24.840974Z", "completed_at": "2024-01-16T15:44:24.858558Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:24.860112Z", "completed_at": "2024-01-16T15:44:30.016749Z"}], "thread_id": "Thread-1", "execution_time": 5.1772613525390625, "adapter_response": {"_message": "SELECT (1.0 rows, 6.5 GiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 6961999223, "bytes_billed": 6962544640, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "405081e9-70ba-475b-b085-8e9de6455c64", "slot_ms": 409453}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__sessions_traffic_sources_session_key.417549e35d", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources`\n  where session_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:28.552046Z", "completed_at": "2024-01-16T15:44:28.570695Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:28.571763Z", "completed_at": "2024-01-16T15:44:34.267631Z"}], "thread_id": "Thread-2", "execution_time": 5.717023611068726, "adapter_response": {"_message": "CREATE TABLE (3.1m rows, 343.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 3102772, "bytes_processed": 359926027, "bytes_billed": 360710144, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "92d4321e-e978-4395-9cbf-7d860008a342", "slot_ms": 49830}, "message": "CREATE TABLE (3.1m rows, 343.3 MiB processed)", "failures": null, "unique_id": "model.ga4.fct_ga4__sessions", "compiled": true, "compiled_code": "-- Stay mindful of performance/cost when using this model. Making this model partitioned on date is not possible because there's no way to create a single record per session AND partition on date. \n\nselect\n    client_key,\n    session_key,\n    stream_id,\n    max(user_id) as user_id,\n    min(session_partition_min_timestamp) as session_start_timestamp,\n    min(session_partition_date) as session_start_date,\n    sum(session_partition_count_page_views) as count_pageviews,\n    sum(session_partition_sum_event_value_in_usd) as sum_event_value_in_usd,\n    max(session_partition_max_session_engaged) as is_session_engaged,\n    sum(session_partition_sum_engagement_time_msec) as sum_engaged_time_msec,\n    min(session_number) as session_number\n    \nfrom `set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions_daily`\ngroup by 1,2,3", "relation_name": "`set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:34.272256Z", "completed_at": "2024-01-16T15:44:34.295027Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:34.296216Z", "completed_at": "2024-01-16T15:44:35.263419Z"}], "thread_id": "Thread-2", "execution_time": 0.992769718170166, "adapter_response": {"_message": "SELECT (1.0 rows, 28.7 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 30115798, "bytes_billed": 30408704, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "0ac1160b-2e02-4062-8458-cd8bc42cefb1", "slot_ms": 61}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__sessions_traffic_sources_daily_session_source.5204b8a71d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect session_source\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_daily`\nwhere session_source is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:17.191648Z", "completed_at": "2024-01-16T15:44:17.232282Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:17.235176Z", "completed_at": "2024-01-16T15:44:35.521244Z"}], "thread_id": "Thread-4", "execution_time": 18.340818643569946, "adapter_response": {"_message": "CREATE TABLE (751.0k rows, 37.7 GiB processed)", "code": "CREATE TABLE", "rows_affected": 750971, "bytes_processed": 40474515779, "bytes_billed": 40475033600, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "138cfac9-7392-4c23-9e4b-d49b15a03fec", "slot_ms": 4170153}, "message": "CREATE TABLE (751.0k rows, 37.7 GiB processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__client_key_first_last_events", "compiled": true, "compiled_code": "\n\nwith first_last_event as (\n    select\n        client_key,\n        FIRST_VALUE(event_key) OVER (PARTITION BY client_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_event,\n        LAST_VALUE(event_key) OVER (PARTITION BY client_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_event,\n        stream_id\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where client_key is not null --remove users with privacy settings enabled\n),\nevents_by_client_key as (\n    select distinct\n        client_key,\n        first_event,\n        last_event,\n        stream_id\n    from first_last_event\n),\nevents_joined as (\n    select\n        events_by_client_key.*,\n        events_first.geo_continent as first_geo_continent,\n        events_first.geo_country as first_geo_country,\n        events_first.geo_region as first_geo_region,\n        events_first.geo_city as first_geo_city,\n        events_first.geo_sub_continent as first_geo_sub_continent,\n        events_first.geo_metro as first_geo_metro,\n        events_first.device_category as first_device_category,\n        events_first.device_mobile_brand_name as first_device_mobile_brand_name,\n        events_first.device_mobile_model_name as first_device_mobile_model_name,\n        events_first.device_mobile_marketing_name as first_device_mobile_marketing_name,\n        events_first.device_mobile_os_hardware_model as first_device_mobile_os_hardware_model,\n        events_first.device_operating_system as first_device_operating_system,\n        events_first.device_operating_system_version as first_device_operating_system_version,\n        events_first.device_vendor_id as first_device_vendor_id,\n        events_first.device_advertising_id as first_device_advertising_id,\n        events_first.device_language as first_device_language,\n        events_first.device_is_limited_ad_tracking as first_device_is_limited_ad_tracking,\n        events_first.device_time_zone_offset_seconds as first_device_time_zone_offset_seconds,\n        events_first.device_browser as first_device_browser,\n        events_first.device_browser_version as first_device_browser_version,\n        events_first.device_web_info_browser as first_device_web_info_browser,\n        events_first.device_web_info_browser_version as first_device_web_info_browser_version,\n        events_first.device_web_info_hostname as first_device_web_info_hostname,\n        events_first.user_campaign as first_user_campaign,\n        events_first.user_medium as first_user_medium,\n        events_first.user_source as first_user_source,\n        events_last.geo_continent as last_geo_continent,\n        events_last.geo_country as last_geo_country,\n        events_last.geo_region as last_geo_region,\n        events_last.geo_city as last_geo_city,\n        events_last.geo_sub_continent as last_geo_sub_continent,\n        events_last.geo_metro as last_geo_metro,\n        events_last.device_category as last_device_category,\n        events_last.device_mobile_brand_name as last_device_mobile_brand_name,\n        events_last.device_mobile_model_name as last_device_mobile_model_name,\n        events_last.device_mobile_marketing_name as last_device_mobile_marketing_name,\n        events_last.device_mobile_os_hardware_model as last_device_mobile_os_hardware_model,\n        events_last.device_operating_system as last_device_operating_system,\n        events_last.device_operating_system_version as last_device_operating_system_version,\n        events_last.device_vendor_id as last_device_vendor_id,\n        events_last.device_advertising_id as last_device_advertising_id,\n        events_last.device_language as last_device_language,\n        events_last.device_is_limited_ad_tracking as last_device_is_limited_ad_tracking,\n        events_last.device_time_zone_offset_seconds as last_device_time_zone_offset_seconds,\n        events_last.device_browser as last_device_browser,\n        events_last.device_browser_version as last_device_browser_version,\n        events_last.device_web_info_browser as last_device_web_info_browser,\n        events_last.device_web_info_browser_version as last_device_web_info_browser_version,\n        events_last.device_web_info_hostname as last_device_web_info_hostname,\n        events_last.user_campaign as last_user_campaign,\n        events_last.user_medium as last_user_medium,\n        events_last.user_source as last_user_source,\n    from events_by_client_key\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__events` events_first\n        on events_by_client_key.first_event = events_first.event_key\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__events` events_last\n        on events_by_client_key.last_event = events_last.event_key\n)\n\nselect * from events_joined", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:29.949690Z", "completed_at": "2024-01-16T15:44:29.969906Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:29.970939Z", "completed_at": "2024-01-16T15:44:37.325583Z"}], "thread_id": "Thread-3", "execution_time": 7.377391576766968, "adapter_response": {"_message": "MERGE (365.0k rows, 9.1 GiB processed)", "code": "MERGE", "rows_affected": 364996, "bytes_processed": 9738238866, "bytes_billed": 9739173888, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "1dbab767-545e-4f45-b202-1bde697dffe3", "slot_ms": 350795}, "message": "MERGE (365.0k rows, 9.1 GiB processed)", "failures": null, "unique_id": "model.ga4.fct_ga4__pages", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\nwith page_view as (\n    select\n        event_date_dt,\n        stream_id,\n        page_location,  -- includes query string parameters not listed in query_parameter_exclusions variable\n        page_key,\n        page_path,\n        page_title,  -- would like to move this to dim_ga4__pages but need to think how to handle page_title changing over time\n        page_engagement_key,\n        count(event_name) as page_views,\n        count(distinct client_key ) as distinct_client_keys,\n        sum( if(session_number = 1,1,0)) as new_client_keys,\n        sum(entrances) as entrances,\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view`\n\n        where event_date_dt in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n\n    group by 1,2,3,4,5,6,7\n), page_engagement as (\n    select\n        page_view.* except(page_engagement_key),\n        sum(page_engagement_time_msec) as total_engagement_time_msec,\n        sum( page_engagement_denominator) as avg_engagement_time_denominator\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__page_engaged_time`\n    right join page_view using (page_engagement_key)\n    group by 1,2,3,4,5,6,7,8,9,10\n), scroll as (\n    select\n        event_date_dt,\n        page_location, \n        page_title,\n        count(event_name) as scroll_events\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_scroll`\n    \n            where event_date_dt in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n    \n    group by 1,2,3\n)\n\nselect\n    page_engagement.* except (page_key),\n    ifnull(scroll.scroll_events, 0) as scroll_events\nfrom page_engagement\nleft join scroll using (event_date_dt, page_location, page_title)\n", "relation_name": "`set-ga-reporting`.`iv_GA4`.`fct_ga4__pages`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:35.267596Z", "completed_at": "2024-01-16T15:44:35.287727Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:35.288806Z", "completed_at": "2024-01-16T15:44:37.615068Z"}], "thread_id": "Thread-2", "execution_time": 2.349067449569702, "adapter_response": {"_message": "SELECT (1.0 rows, 106.7 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 111934404, "bytes_billed": 112197632, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "6e4c6b27-905b-4eb8-ab4b-b825dd5d2dcd", "slot_ms": 10496}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__sessions_traffic_sources_daily_session_partition_key.0a63631827", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_partition_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_daily`\n  where session_partition_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:37.330108Z", "completed_at": "2024-01-16T15:44:37.351687Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:37.352672Z", "completed_at": "2024-01-16T15:44:39.197258Z"}], "thread_id": "Thread-3", "execution_time": 1.8687803745269775, "adapter_response": {"_message": "SELECT (1.0 rows, 76.9 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 80672072, "bytes_billed": 80740352, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "afc2a56c-6f44-449b-be54-d420db56a0fb", "slot_ms": 7034}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_fct_ga4__sessions_session_key.93f6a798f0", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions`\n  where session_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:37.619336Z", "completed_at": "2024-01-16T15:44:37.641257Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:37.642427Z", "completed_at": "2024-01-16T15:44:39.649909Z"}], "thread_id": "Thread-2", "execution_time": 2.0324270725250244, "adapter_response": {"_message": "SELECT (1.0 rows, 18.6 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 19525246, "bytes_billed": 19922944, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "d41670f8-436a-40f8-b8ee-517cc59947b4", "slot_ms": 1954}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__client_key_first_last_events_client_key.ed9b2aba25", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select client_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_events`\n  where client_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:30.020953Z", "completed_at": "2024-01-16T15:44:30.036869Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:30.037917Z", "completed_at": "2024-01-16T15:44:40.794458Z"}], "thread_id": "Thread-1", "execution_time": 10.77492904663086, "adapter_response": {"_message": "CREATE TABLE (570.2k rows, 11.8 GiB processed)", "code": "CREATE TABLE", "rows_affected": 570231, "bytes_processed": 12684450735, "bytes_billed": 12684623872, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "c039f838-317b-44f8-9c8f-3935913929e4", "slot_ms": 614968}, "message": "CREATE TABLE (570.2k rows, 11.8 GiB processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__client_key_first_last_pageviews", "compiled": true, "compiled_code": "\n\nwith page_views_first_last as (\n    select\n        client_key,\n        FIRST_VALUE(event_key) OVER (PARTITION BY client_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_page_view_event_key,\n        LAST_VALUE(event_key) OVER (PARTITION BY client_key ORDER BY event_timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_page_view_event_key\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view`\n    where client_key is not null -- Remove users with privacy settings enabled\n),\npage_views_by_client_key as (\n    select distinct\n        client_key,\n        first_page_view_event_key,\n        last_page_view_event_key\n    from page_views_first_last\n),\n\npage_views_joined as (\n    select\n        page_views_by_client_key.*,\n        first_page_view.page_location as first_page_location,\n        first_page_view.page_hostname as first_page_hostname,\n        first_page_view.page_referrer as first_page_referrer, \n        last_page_view.page_location as last_page_location,\n        last_page_view.page_hostname as last_page_hostname,\n        last_page_view.page_referrer as last_page_referrer\n    from page_views_by_client_key\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view` first_page_view\n        on page_views_by_client_key.first_page_view_event_key = first_page_view.event_key\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__event_page_view` last_page_view\n        on page_views_by_client_key.last_page_view_event_key = last_page_view.event_key\n)\n\nselect * from page_views_joined", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_pageviews`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:40.822300Z", "completed_at": "2024-01-16T15:44:40.840782Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:40.842083Z", "completed_at": "2024-01-16T15:44:42.547617Z"}], "thread_id": "Thread-1", "execution_time": 1.7270119190216064, "adapter_response": {"_message": "SELECT (1.0 rows, 14.1 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 14826006, "bytes_billed": 15728640, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "690fe809-62d7-4999-ad69-6e1472e2f5a8", "slot_ms": 1530}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__client_key_first_last_pageviews_client_key.4cb23d702f", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select client_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_pageviews`\n  where client_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:39.201673Z", "completed_at": "2024-01-16T15:44:39.230817Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:39.232164Z", "completed_at": "2024-01-16T15:44:43.619774Z"}], "thread_id": "Thread-3", "execution_time": 4.419581413269043, "adapter_response": {"_message": "MERGE (515.9k rows, 498.4 MiB processed)", "code": "MERGE", "rows_affected": 515868, "bytes_processed": 522655733, "bytes_billed": 523239424, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "d05cb8f4-917f-493f-bf69-9bdea65d756f", "slot_ms": 26755}, "message": "MERGE (515.9k rows, 498.4 MiB processed)", "failures": null, "unique_id": "model.ga4.stg_ga4__sessions_traffic_sources_last_non_direct_daily", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\nwith last_non_direct_session_partition_key as (\n  select\n    client_key\n    ,session_partition_key\n    ,session_partition_date\n    ,session_source\n    ,session_medium\n    ,session_source_category\n    ,session_campaign\n    ,session_content\n    ,session_term\n    ,session_default_channel_grouping\n    ,non_direct_session_partition_key\n    ,CASE\n      WHEN non_direct_session_partition_key is null\n      THEN \n          last_value(non_direct_session_partition_key ignore nulls) over(\n          partition by client_key\n          order by\n              session_partition_timestamp range between 2592000000000 preceding\n              and current row -- lookback window \n          )\n      ELSE non_direct_session_partition_key\n    END as session_partition_key_last_non_direct,\n  from\n  `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_daily`\n  \n      -- Add 30 to static_incremental_days to include the session attribution lookback window\n      where session_partition_date >= date_sub(current_date, interval (33 ) day)\n  \n)\n,join_last_non_direct_session_source as (\n  select\n    last_non_direct_session_partition_key.client_key\n    ,last_non_direct_session_partition_key.session_partition_key\n    ,last_non_direct_session_partition_key.session_partition_date\n    ,last_non_direct_session_partition_key.session_source\n    ,last_non_direct_session_partition_key.session_medium\n    ,last_non_direct_session_partition_key.session_source_category\n    ,last_non_direct_session_partition_key.session_campaign\n    ,last_non_direct_session_partition_key.session_content\n    ,last_non_direct_session_partition_key.session_term\n    ,last_non_direct_session_partition_key.session_default_channel_grouping\n    ,last_non_direct_session_partition_key.session_partition_key_last_non_direct\n    ,coalesce(last_non_direct_source.session_source, '(direct)') as last_non_direct_source -- Value will be null if only direct sessions are within the lookback window\n    ,coalesce(last_non_direct_source.session_medium, '(none)') as last_non_direct_medium\n    ,coalesce(last_non_direct_source.session_source_category, '(none)') as last_non_direct_source_category\n    ,coalesce(last_non_direct_source.session_campaign, '(none)') as last_non_direct_campaign\n    ,coalesce(last_non_direct_source.session_content, '(none)') as last_non_direct_content\n    ,coalesce(last_non_direct_source.session_term, '(none)') as last_non_direct_term\n    ,coalesce(last_non_direct_source.session_default_channel_grouping, '(none)') as last_non_direct_default_channel_grouping\n  from last_non_direct_session_partition_key\n  left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_daily` last_non_direct_source on\n    last_non_direct_session_partition_key.session_partition_key_last_non_direct = last_non_direct_source.session_partition_key\n  \n      -- Only keep the records in the partitions we wish to replace (as opposed to the whole 30 day lookback window)\n      where last_non_direct_session_partition_key.session_partition_date in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n  \n)\n\nselect * from join_last_non_direct_session_source", "relation_name": "`set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:43.624476Z", "completed_at": "2024-01-16T15:44:43.641909Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:43.642962Z", "completed_at": "2024-01-16T15:44:44.589488Z"}], "thread_id": "Thread-3", "execution_time": 0.9666595458984375, "adapter_response": {"_message": "SELECT (1.0 rows, 30.0 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 31450830, "bytes_billed": 31457280, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "d74a4bdd-53cc-49ae-8663-82988fdbfe26", "slot_ms": 63}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__sessions_traffic_sources_last_non_direct_daily_last_non_direct_default_channel_grouping.2483b5ae6b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect last_non_direct_default_channel_grouping\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`\nwhere last_non_direct_default_channel_grouping is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:44.593680Z", "completed_at": "2024-01-16T15:44:44.614074Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:44.615167Z", "completed_at": "2024-01-16T15:44:45.609383Z"}], "thread_id": "Thread-3", "execution_time": 1.0173721313476562, "adapter_response": {"_message": "SELECT (1.0 rows, 28.5 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 29930014, "bytes_billed": 30408704, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "01a2903c-0ce1-4ce3-a3de-2d8db950c41c", "slot_ms": 75}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__sessions_traffic_sources_last_non_direct_daily_last_non_direct_source.449fe23be6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect last_non_direct_source\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`\nwhere last_non_direct_source is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:35.526037Z", "completed_at": "2024-01-16T15:44:35.545893Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:35.547336Z", "completed_at": "2024-01-16T15:44:46.214602Z"}], "thread_id": "Thread-4", "execution_time": 10.690022706985474, "adapter_response": {"_message": "CREATE TABLE (3.1m rows, 23.4 GiB processed)", "code": "CREATE TABLE", "rows_affected": 3100244, "bytes_processed": 25148583292, "bytes_billed": 25149046784, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "e3a1e679-e882-4a0e-82b2-bee59736d4a6", "slot_ms": 1629334}, "message": "CREATE TABLE (3.1m rows, 23.4 GiB processed)", "failures": null, "unique_id": "model.ga4.dim_ga4__sessions", "compiled": true, "compiled_code": "-- Dimension table for sessions based on the first event that isn't session_start or first_visit.\nwith session_first_event as \n(\n    select *\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where event_name != 'first_visit' \n    and event_name != 'session_start'\n    qualify row_number() over(partition by session_key order by event_timestamp) = 1\n),\n session_start_dims as (\n    select \n        session_key,\n        event_date_dt as session_start_date,\n        event_timestamp as session_start_timestamp,\n        page_path as landing_page_path,\n        page_location as landing_page,\n        page_hostname as landing_page_hostname,\n        page_referrer as landing_page_referrer,\n        geo_continent,\n        geo_country,\n        geo_region,\n        geo_city,\n        geo_sub_continent,\n        geo_metro,\n        stream_id,\n        platform,\n        device_category,\n        device_mobile_brand_name,\n        device_mobile_model_name,\n        device_mobile_marketing_name,\n        device_mobile_os_hardware_model,\n        device_operating_system,\n        device_operating_system_version,\n        device_vendor_id,\n        device_advertising_id,\n        device_language,\n        device_is_limited_ad_tracking,\n        device_time_zone_offset_seconds,\n        device_browser,\n        device_web_info_browser,\n        device_web_info_browser_version,\n        device_web_info_hostname,\n        session_number,\n        session_number = 1 as is_first_session,\n        user_campaign,\n        user_medium,\n        user_source,\n    from session_first_event\n),\njoin_traffic_source as (\n    select \n        session_start_dims.*,\n        sessions_traffic_sources.session_source,\n        sessions_traffic_sources.session_medium,\n        sessions_traffic_sources.session_campaign,\n        sessions_traffic_sources.session_content,\n        sessions_traffic_sources.session_term,\n        sessions_traffic_sources.session_default_channel_grouping,\n        sessions_traffic_sources.session_source_category\n    from session_start_dims\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources` sessions_traffic_sources using (session_key)\n),\ninclude_session_properties as (\n    select \n        * \n    from join_traffic_source\n    \n)\n\nselect * from include_session_properties", "relation_name": "`set-ga-reporting`.`iv_GA4`.`dim_ga4__sessions`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:45.613506Z", "completed_at": "2024-01-16T15:44:45.632614Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:45.633659Z", "completed_at": "2024-01-16T15:44:46.532665Z"}], "thread_id": "Thread-3", "execution_time": 0.9208693504333496, "adapter_response": {"_message": "SELECT (1.0 rows, 28.7 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 30115798, "bytes_billed": 30408704, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "c04e5600-dd98-4ad9-8307-68a46f39a35f", "slot_ms": 40}, "message": null, "failures": 0, "unique_id": "test.ga4.not_null_stg_ga4__sessions_traffic_sources_last_non_direct_daily_session_source.db8c720050", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect session_source\nfrom `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`\nwhere session_source is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:46.219177Z", "completed_at": "2024-01-16T15:44:46.237294Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:46.238350Z", "completed_at": "2024-01-16T15:44:48.039696Z"}], "thread_id": "Thread-4", "execution_time": 1.8224623203277588, "adapter_response": {"_message": "SELECT (1.0 rows, 106.7 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 111934404, "bytes_billed": 112197632, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "599809b5-9edf-442f-8241-38a5dbc46ff2", "slot_ms": 8028}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_stg_ga4__sessions_traffic_sources_last_non_direct_daily_session_partition_key.5383afcda4", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_partition_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`\n  where session_partition_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:46.537068Z", "completed_at": "2024-01-16T15:44:46.557011Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:46.558190Z", "completed_at": "2024-01-16T15:44:48.335503Z"}], "thread_id": "Thread-3", "execution_time": 1.8000047206878662, "adapter_response": {"_message": "SELECT (1.0 rows, 76.9 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 80606318, "bytes_billed": 80740352, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "56a7b6cc-fa48-405b-8e16-9ef64f32d0be", "slot_ms": 7889}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_dim_ga4__sessions_session_key.5ade237063", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`dim_ga4__sessions`\n  where session_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:39.654488Z", "completed_at": "2024-01-16T15:44:39.675197Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:39.676430Z", "completed_at": "2024-01-16T15:44:50.979011Z"}], "thread_id": "Thread-2", "execution_time": 11.326030492782593, "adapter_response": {"_message": "CREATE TABLE (749.0k rows, 307.8 MiB processed)", "code": "CREATE TABLE", "rows_affected": 748996, "bytes_processed": 322705648, "bytes_billed": 322961408, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "240edefa-6491-4268-8ff6-3a571e02ad69", "slot_ms": 50950}, "message": "CREATE TABLE (749.0k rows, 307.8 MiB processed)", "failures": null, "unique_id": "model.ga4.fct_ga4__client_keys", "compiled": true, "compiled_code": "select\n    client_key,\n    stream_id,\n    min(session_start_timestamp) as first_seen_timestamp,\n    min(session_start_date) as first_seen_start_date,\n    sum(count_pageviews) as count_pageviews,\n    sum(is_session_engaged) as count_engaged_sessions,\n    sum(sum_event_value_in_usd) as sum_event_value_in_usd,\n    sum(sum_engaged_time_msec) as sum_engaged_time_msec,\n    count(distinct session_key)  as count_sessions\n    \nfrom `set-ga-reporting`.`iv_GA4`.`fct_ga4__sessions`\ngroup by 1, 2", "relation_name": "`set-ga-reporting`.`iv_GA4`.`fct_ga4__client_keys`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:42.552071Z", "completed_at": "2024-01-16T15:44:42.572239Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:42.573513Z", "completed_at": "2024-01-16T15:44:52.179525Z"}], "thread_id": "Thread-1", "execution_time": 9.628885984420776, "adapter_response": {"_message": "CREATE TABLE (751.0k rows, 546.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 750971, "bytes_processed": 572917897, "bytes_billed": 573571072, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "e2623be4-b7bc-47b7-940a-79a6884b83ee", "slot_ms": 32608}, "message": "CREATE TABLE (751.0k rows, 546.4 MiB processed)", "failures": null, "unique_id": "model.ga4.dim_ga4__client_keys", "compiled": true, "compiled_code": "-- Mart for dimensions related to user devices (based on client_key)\n\nwith include_first_last_events as (\n    select \n        *\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_events`\n),\ninclude_first_last_page_views as (\n    select \n        include_first_last_events.*,\n        first_last_page_views.first_page_location,\n        first_last_page_views.first_page_hostname,\n        first_last_page_views.first_page_referrer,\n        first_last_page_views.last_page_location,\n        first_last_page_views.last_page_hostname,\n        first_last_page_views.last_page_referrer\n    from include_first_last_events \n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__client_key_first_last_pageviews` as first_last_page_views using (client_key)\n),\ninclude_user_properties as (\n    \n\nselect * from include_first_last_page_views\n\n\n\n)\n\nselect * from include_user_properties", "relation_name": "`set-ga-reporting`.`iv_GA4`.`dim_ga4__client_keys`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:50.983884Z", "completed_at": "2024-01-16T15:44:51.009143Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:51.010666Z", "completed_at": "2024-01-16T15:44:53.275482Z"}], "thread_id": "Thread-3", "execution_time": 2.2933173179626465, "adapter_response": {"_message": "SELECT (1.0 rows, 18.6 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 19473896, "bytes_billed": 19922944, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "1f70de7b-4ba1-426e-9c87-038cbc4dfd91", "slot_ms": 1970}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_fct_ga4__client_keys_client_key.47115ed1b5", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select client_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`fct_ga4__client_keys`\n  where client_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:52.184387Z", "completed_at": "2024-01-16T15:44:52.201618Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:52.202854Z", "completed_at": "2024-01-16T15:44:53.818191Z"}], "thread_id": "Thread-2", "execution_time": 1.6353888511657715, "adapter_response": {"_message": "SELECT (1.0 rows, 18.6 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 19525246, "bytes_billed": 19922944, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "571380a4-da14-412a-be85-d40245dcac44", "slot_ms": 1743}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_dim_ga4__client_keys_client_key.971e8b17de", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select client_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`dim_ga4__client_keys`\n  where client_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:53.281354Z", "completed_at": "2024-01-16T15:44:53.303915Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:53.305137Z", "completed_at": "2024-01-16T15:44:59.325014Z"}], "thread_id": "Thread-1", "execution_time": 6.045454740524292, "adapter_response": {"_message": "CREATE TABLE (737.4k rows, 3.7 GiB processed)", "code": "CREATE TABLE", "rows_affected": 737415, "bytes_processed": 3949301866, "bytes_billed": 3949985792, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "78977091-658d-41aa-912b-9046722fbb93", "slot_ms": 122016}, "message": "CREATE TABLE (737.4k rows, 3.7 GiB processed)", "failures": null, "unique_id": "model.ga4.fct_ga4__user_ids", "compiled": true, "compiled_code": "with user_id_mapped as (\n    select \n        client_keys.*,\n        -- Use a user_id if it exists, otherwise fall back to the client_key\n        coalesce(user_id_mapping.last_seen_user_id, client_keys.client_key) as user_id_or_client_key,\n        -- Indicate whether the user_id_or_client_key value is a user_id\n        CASE \n            WHEN user_id_mapping.last_seen_user_id is null THEN 0 ELSE 1\n        END as is_user_id\n    from `set-ga-reporting`.`iv_GA4`.`fct_ga4__client_keys` client_keys\n    left join `set-ga-reporting`.`iv_GA4`.`stg_ga4__user_id_mapping` user_id_mapping using (client_key)\n)\n\nselect\n    user_id_or_client_key,\n    stream_id,\n    max(is_user_id) as is_user_id,\n    min(first_seen_timestamp) as first_seen_timestamp,\n    min(first_seen_start_date) as first_seen_start_date,\n    sum(count_pageviews) as count_pageviews,\n    sum(count_engaged_sessions) as count_engaged_sessions,\n    sum(sum_event_value_in_usd) as sum_event_value_in_usd,\n    sum(sum_engaged_time_msec) as sum_engaged_time_msec,\n    sum(count_sessions) as count_sessions\n    \nfrom user_id_mapped\ngroup by 1, 2", "relation_name": "`set-ga-reporting`.`iv_GA4`.`fct_ga4__user_ids`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:48.046570Z", "completed_at": "2024-01-16T15:44:48.095540Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:48.097318Z", "completed_at": "2024-01-16T15:45:01.304867Z"}], "thread_id": "Thread-4", "execution_time": 13.260332345962524, "adapter_response": {"_message": "MERGE (515.9k rows, 1.9 GiB processed)", "code": "MERGE", "rows_affected": 515892, "bytes_processed": 2088830889, "bytes_billed": 2089811968, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "896de128-0795-4a2c-a257-ca86f2955a6b", "slot_ms": 215213}, "message": "MERGE (515.9k rows, 1.9 GiB processed)", "failures": null, "unique_id": "model.ga4.dim_ga4__sessions_daily", "compiled": true, "compiled_code": "\n\n    \n\n    \n\n    \n\n\n\n\nwith event_dimensions as \n(\n    select \n        client_key,\n        session_key,\n        session_partition_key,\n        event_date_dt as session_partition_date,\n        event_timestamp,\n        page_path,\n        page_location,\n        page_hostname,\n        page_referrer,\n        geo_continent,\n        geo_country,\n        geo_region,\n        geo_city,\n        geo_sub_continent,\n        geo_metro,\n        stream_id,\n        platform,\n        device_category,\n        device_mobile_brand_name,\n        device_mobile_model_name,\n        device_mobile_marketing_name,\n        device_mobile_os_hardware_model,\n        device_operating_system,\n        device_operating_system_version,\n        device_vendor_id,\n        device_advertising_id,\n        device_language,\n        device_is_limited_ad_tracking,\n        device_time_zone_offset_seconds,\n        device_browser,\n        device_web_info_browser,\n        device_web_info_browser_version,\n        device_web_info_hostname,\n        user_campaign,\n        user_medium,\n        user_source,\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__events`\n    where event_name != 'first_visit' \n    and event_name != 'session_start'\n    \n            and event_date_dt in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n    \n)\n,traffic_sources as (\n    select \n        session_partition_key,\n        session_source,\n        session_medium,\n        session_campaign,\n        session_content,\n        session_term,\n        session_default_channel_grouping,\n        session_source_category,\n        -- last non-direct traffic sources\n        last_non_direct_source,\n        last_non_direct_medium,\n        last_non_direct_campaign,\n        last_non_direct_content,\n        last_non_direct_term,\n        last_non_direct_default_channel_grouping,\n        last_non_direct_source_category\n    from `set-ga-reporting`.`iv_GA4`.`stg_ga4__sessions_traffic_sources_last_non_direct_daily`\n    where 1=1\n    \n            and session_partition_date in (current_date,date_sub(current_date, interval 1 day),date_sub(current_date, interval 2 day),date_sub(current_date, interval 3 day))\n     \n)\n\n,session_dimensions as \n(\n    select    \n        distinct -- Distinct call will, in effect, group by session_partition_key\n        stream_id\n        ,session_key\n        ,session_partition_key\n        ,session_partition_date\n        ,FIRST_VALUE(event_timestamp IGNORE NULLS) OVER (session_partition_window) AS session_partition_start_timestamp\n        ,FIRST_VALUE(page_path IGNORE NULLS) OVER (session_partition_window) AS landing_page_path\n        ,FIRST_VALUE(page_location IGNORE NULLS) OVER (session_partition_window) AS landing_page_location\n        ,FIRST_VALUE(page_hostname IGNORE NULLS) OVER (session_partition_window) AS landing_page_hostname\n        ,FIRST_VALUE(page_referrer IGNORE NULLS) OVER (session_partition_window) AS referrer\n        ,FIRST_VALUE(geo_continent IGNORE NULLS) OVER (session_partition_window) AS geo_continent\n        ,FIRST_VALUE(geo_country IGNORE NULLS) OVER (session_partition_window) AS geo_country\n        ,FIRST_VALUE(geo_region IGNORE NULLS) OVER (session_partition_window) AS geo_region\n        ,FIRST_VALUE(geo_city IGNORE NULLS) OVER (session_partition_window) AS geo_city\n        ,FIRST_VALUE(geo_sub_continent IGNORE NULLS) OVER (session_partition_window) AS geo_sub_continent\n        ,FIRST_VALUE(geo_metro IGNORE NULLS) OVER (session_partition_window) AS geo_metro\n        ,FIRST_VALUE(platform IGNORE NULLS) OVER (session_partition_window) AS platform\n        ,FIRST_VALUE(device_category IGNORE NULLS) OVER (session_partition_window) AS device_category\n        ,FIRST_VALUE(device_mobile_brand_name IGNORE NULLS) OVER (session_partition_window) AS device_mobile_brand_name\n        ,FIRST_VALUE(device_mobile_model_name IGNORE NULLS) OVER (session_partition_window) AS device_mobile_model_name\n        ,FIRST_VALUE(device_mobile_marketing_name IGNORE NULLS) OVER (session_partition_window) AS device_mobile_marketing_name\n        ,FIRST_VALUE(device_mobile_os_hardware_model IGNORE NULLS) OVER (session_partition_window) AS device_mobile_os_hardware_model\n        ,FIRST_VALUE(device_operating_system IGNORE NULLS) OVER (session_partition_window) AS device_operating_system\n        ,FIRST_VALUE(device_operating_system_version IGNORE NULLS) OVER (session_partition_window) AS device_operating_system_version\n        ,FIRST_VALUE(device_vendor_id IGNORE NULLS) OVER (session_partition_window) AS device_vendor_id\n        ,FIRST_VALUE(device_advertising_id IGNORE NULLS) OVER (session_partition_window) AS device_advertising_id\n        ,FIRST_VALUE(device_language IGNORE NULLS) OVER (session_partition_window) AS device_language\n        ,FIRST_VALUE(device_is_limited_ad_tracking IGNORE NULLS) OVER (session_partition_window) AS device_is_limited_ad_tracking\n        ,FIRST_VALUE(device_time_zone_offset_seconds IGNORE NULLS) OVER (session_partition_window) AS device_time_zone_offset_seconds\n        ,FIRST_VALUE(device_browser IGNORE NULLS) OVER (session_partition_window) AS device_browser\n        ,FIRST_VALUE(device_web_info_browser IGNORE NULLS) OVER (session_partition_window) AS device_web_info_browser\n        ,FIRST_VALUE(device_web_info_browser_version IGNORE NULLS) OVER (session_partition_window) AS device_web_info_browser_version\n        ,FIRST_VALUE(device_web_info_hostname IGNORE NULLS) OVER (session_partition_window) AS device_web_info_hostname\n        ,FIRST_VALUE(user_campaign IGNORE NULLS) OVER (session_partition_window) AS user_campaign\n        ,FIRST_VALUE(user_medium IGNORE NULLS) OVER (session_partition_window) AS user_medium\n        ,FIRST_VALUE(user_source IGNORE NULLS) OVER (session_partition_window) AS user_source\n        from event_dimensions\n    WINDOW session_partition_window AS (PARTITION BY session_partition_key ORDER BY event_timestamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)\n)\n,join_traffic_source as (\n    select \n        session_dimensions.*,\n        session_source,\n        session_medium,\n        session_campaign,\n        session_content,\n        session_term,\n        session_default_channel_grouping,\n        session_source_category,\n        -- last non-direct traffic sources\n        last_non_direct_source,\n        last_non_direct_medium,\n        last_non_direct_campaign,\n        last_non_direct_content,\n        last_non_direct_term,\n        last_non_direct_default_channel_grouping,\n        last_non_direct_source_category\n    from session_dimensions\n    left join traffic_sources sessions_traffic_sources using (session_partition_key)\n)\n,join_session_properties as (\n    select \n        * \n    from join_traffic_source\n    \n)\n\n-- Collapse \nselect distinct * from join_session_properties", "relation_name": "`set-ga-reporting`.`iv_GA4`.`dim_ga4__sessions_daily`"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:44:59.330370Z", "completed_at": "2024-01-16T15:44:59.355504Z"}, {"name": "execute", "started_at": "2024-01-16T15:44:59.356641Z", "completed_at": "2024-01-16T15:45:01.705055Z"}], "thread_id": "Thread-3", "execution_time": 2.376365900039673, "adapter_response": {"_message": "SELECT (1.0 rows, 24.6 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 25790325, "bytes_billed": 26214400, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "ecab0375-efed-42c1-8edb-a2c022102039", "slot_ms": 2708}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_fct_ga4__user_ids_md5_user_id_or_client_key_stream_id_.dcd4dac43e", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select md5(user_id_or_client_key || stream_id) as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`fct_ga4__user_ids`\n  where md5(user_id_or_client_key || stream_id) is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2024-01-16T15:45:01.309808Z", "completed_at": "2024-01-16T15:45:01.330949Z"}, {"name": "execute", "started_at": "2024-01-16T15:45:01.332597Z", "completed_at": "2024-01-16T15:45:03.415164Z"}], "thread_id": "Thread-1", "execution_time": 2.106950521469116, "adapter_response": {"_message": "SELECT (1.0 rows, 106.7 MiB processed)", "code": "SELECT", "rows_affected": 1, "bytes_processed": 111934404, "bytes_billed": 112197632, "location": "europe-west2", "project_id": "set-ga-reporting", "job_id": "27df6727-8f37-4ee7-96c6-18fe5369cc37", "slot_ms": 8946}, "message": null, "failures": 0, "unique_id": "test.ga4.unique_dim_ga4__sessions_daily_session_partition_key.e40d884a13", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select session_partition_key as unique_field\n  from `set-ga-reporting`.`iv_GA4`.`dim_ga4__sessions_daily`\n  where session_partition_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}], "elapsed_time": 65.67439365386963, "args": {"exclude": [], "defer": false, "print": true, "send_anonymous_usage_stats": true, "log_format": "json", "printer_width": 80, "static_parser": true, "project_dir": "/usr/src/develop/user-187474/environment-278010/repository-199827", "use_colors": true, "profiles_dir": "/usr/src/dbt-server-shared/.dbt", "partial_parse": true, "select": [], "indirect_selection": "eager", "profile": "user", "cache_selected_only": false, "resource_types": [], "log_path": "/usr/src/dbt-server-shared/working_dir/c91709e6-f195-4a7e-824f-00ebf5e72b6a", "populate_cache": true, "warn_error_options": {"include": [], "exclude": []}, "show": false, "use_colors_file": true, "version_check": true, "include_saved_query": false, "invocation_command": "dbt -A dbt_worker.app worker --loglevel=DEBUG --concurrency=2 --max-memory-per-child=500000", "partial_parse_file_diff": true, "log_level": "info", "show_resource_report": false, "macro_debugging": false, "strict_mode": false, "enable_legacy_logger": false, "vars": {}, "log_level_file": "debug", "quiet": false, "log_format_file": "json", "introspect": true, "which": "build", "write_json": true, "log_file_max_bytes": 0, "favor_state": false}}